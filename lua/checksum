-- checksum.lua
-- We define a variable to track if we've run the check
local hasChecked = false

function script.update(dt)
    -- This function runs every single frame (60+ times a second)
    
    if not hasChecked then
        hasChecked = true
        
        -- Run your check logic HERE
        ac.log("--- STARTING CHECK ---")
        
        -- Use focusedCar so it checks YOU, not just Slot 0
        local carIndex = ac.getSim().focusedCar 
        local carModel = ac.getCarName(carIndex)
        
        ac.log("Checking Car: " .. tostring(carModel))

        if carModel == "rss_formula_hybrid_2025_alpine" then
            local filePath = "content/cars/" .. carModel .. "/data.acd"
            local file = io.open(filePath, "rb")
            
            if file then
                -- Do the read test
                local size = file:seek("end")
                file:close()
                ac.log("✅ File Found. Size: " .. size)
                ac.sendChatMessage("System: Integrity Check Passed.")
            else
                ac.log("❌ File Missing/Locked!")
                ac.sendChatMessage("System: INTEGRITY FAIL - data.acd missing")
            end
        else
            ac.log("Skipping check (Different Car)")
        end
    end
end
