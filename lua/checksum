-- checksum
-- ALIVE CHECK: Prints to chat every 5 seconds

local timer = 0
local checkHasRun = false

function script.update(dt)
    -- Add the time passed since the last frame (dt = delta time)
    timer = timer + dt

    -- EVERY 5 SECONDS:
    if timer > 5 then
        timer = 0 -- Reset timer
        
        -- 1. Send visible chat message
        ac.sendChatMessage("üíì SCRIPT IS ALIVE - Checking Integrity...")
        
        -- 2. Log to console (F9 key or /log)
        ac.log("Heartbeat: Script running at " .. os.date())
        
        -- 3. Run the file check (Only runs once per session to save performance)
        if not checkHasRun then
            local carModel = ac.getCarName(0)
            
            if carModel == "rss_formula_hybrid_2025_alpine" then
                local filePath = "content/cars/" .. carModel .. "/data.acd"
                local f = io.open(filePath, "rb")
                
                if f then
                    local size = f:seek("end")
                    f:close()
                    ac.sendChatMessage("‚úÖ INTEGRITY PASSED: data.acd found (".. size .." bytes)")
                else
                    ac.sendChatMessage("‚ùå INTEGRITY FAILED: data.acd MISSING")
                end
            else
                ac.sendChatMessage("‚ÑπÔ∏è Info: Not driving the Alpine (Skipping check)")
            end
            
            checkHasRun = true -- Stop checking the file, but keep printing the heartbeat
        end
    end
end
